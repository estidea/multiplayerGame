<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Аркада на canvas</title>
	<link rel="stylesheet" href="css/style.css">
	<style>
		body, html {
			margin:0;
			width:  100%;
			height: 100%;
			background-color: #2d2d2d;
		}
	</style>
</head>
<body>
	<button onclick="happy()">Happy!</button>
	<canvas id="canvas-main"></canvas>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
	<script>
		var canvas = document.getElementById("canvas-main");

		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		var WIDTH = canvas.width;
		var HEIGHT = canvas.height;

		var ctx = canvas.getContext('2d');
		var socket = io();

		var happy = function() {
			socket.emit('happy', {
				reason: 'it\'s my birthday'
			});
		}

		ctx.font = "40px Arial";
		// цвет
		ctx.fillStyle = "#29e929";

		socket.on('newPositions',function(data){
			ctx.clearRect(0,0,WIDTH,HEIGHT);
			for (var i=0;i<data.length;i++){
				ctx.fillText(data[i].name,data[i].x,data[i].y);
			}
		})

		document.onkeydown = function(e) {
			if(e.keyCode === 68) //d
				socket.emit('keyPress',{inputId:'right', state:true});
			if(e.keyCode === 83) //s
				socket.emit('keyPress',{inputId:'bottom', state:true});
			if(e.keyCode === 65) //a
				socket.emit('keyPress',{inputId:'left', state:true});
			if(e.keyCode === 87) //w
				socket.emit('keyPress',{inputId:'top', state:true});
		}

		document.onkeyup = function(e) {
			if(e.keyCode === 68) //d
				socket.emit('keyPress',{inputId:'right', state:false});
			if(e.keyCode === 83) //s
				socket.emit('keyPress',{inputId:'bottom', state:false});
			if(e.keyCode === 65) //a
				socket.emit('keyPress',{inputId:'left', state:false});
			if(e.keyCode === 87) //w
				socket.emit('keyPress',{inputId:'top', state:false});
		}

		
	</script>
</body>
</html>